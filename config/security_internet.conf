# =============================================================================
# NoctisPro PACS - Internet Security Configuration
# =============================================================================
# Security settings for public internet deployment with HTTPS
# =============================================================================

# Domain and SSL Configuration
DOMAIN_NAME=${DOMAIN_NAME:-localhost}
USE_HTTPS=${USE_HTTPS:-true}
FORCE_SSL_REDIRECT=${FORCE_SSL_REDIRECT:-true}
HSTS_MAX_AGE=${HSTS_MAX_AGE:-31536000}

# Session Security
SESSION_COOKIE_AGE=${SESSION_COOKIE_AGE:-3600}
SESSION_COOKIE_SECURE=${SESSION_COOKIE_SECURE:-true}
SESSION_COOKIE_HTTPONLY=${SESSION_COOKIE_HTTPONLY:-true}
SESSION_COOKIE_SAMESITE=${SESSION_COOKIE_SAMESITE:-Strict}

# CSRF Protection
CSRF_COOKIE_SECURE=${CSRF_COOKIE_SECURE:-true}
CSRF_COOKIE_HTTPONLY=${CSRF_COOKIE_HTTPONLY:-true}
CSRF_COOKIE_SAMESITE=${CSRF_COOKIE_SAMESITE:-Strict}

# Content Security Policy
CSP_DEFAULT_SRC=${CSP_DEFAULT_SRC:-'self'}
CSP_SCRIPT_SRC=${CSP_SCRIPT_SRC:-'self' 'unsafe-inline' 'unsafe-eval'}
CSP_STYLE_SRC=${CSP_STYLE_SRC:-'self' 'unsafe-inline'}
CSP_IMG_SRC=${CSP_IMG_SRC:-'self' data: https:}
CSP_FONT_SRC=${CSP_FONT_SRC:-'self' data:}
CSP_CONNECT_SRC=${CSP_CONNECT_SRC:-'self'}
CSP_FRAME_ANCESTORS=${CSP_FRAME_ANCESTORS:-'none'}

# Rate Limiting
RATE_LIMIT_LOGIN=${RATE_LIMIT_LOGIN:-5r/m}
RATE_LIMIT_API=${RATE_LIMIT_API:-30r/m}
RATE_LIMIT_GENERAL=${RATE_LIMIT_GENERAL:-60r/m}

# Connection Limits
MAX_CONNECTIONS_PER_IP=${MAX_CONNECTIONS_PER_IP:-20}
CLIENT_BODY_TIMEOUT=${CLIENT_BODY_TIMEOUT:-10s}
CLIENT_HEADER_TIMEOUT=${CLIENT_HEADER_TIMEOUT:-10s}
KEEPALIVE_TIMEOUT=${KEEPALIVE_TIMEOUT:-5s}

# File Upload Security
MAX_UPLOAD_SIZE=${MAX_UPLOAD_SIZE:-100M}
MAX_BODY_SIZE=${MAX_BODY_SIZE:-100M}

# Database Security
DB_SSL_MODE=${DB_SSL_MODE:-require}
DB_CONNECTION_TIMEOUT=${DB_CONNECTION_TIMEOUT:-30}
DB_MAX_CONNECTIONS=${DB_MAX_CONNECTIONS:-100}

# Redis Security
REDIS_REQUIRE_AUTH=${REDIS_REQUIRE_AUTH:-true}
REDIS_TIMEOUT=${REDIS_TIMEOUT:-30}

# Logging Security
LOG_LEVEL=${LOG_LEVEL:-INFO}
ACCESS_LOG_FORMAT=${ACCESS_LOG_FORMAT:-combined}
ERROR_LOG_LEVEL=${ERROR_LOG_LEVEL:-warn}

# Security Headers
X_FRAME_OPTIONS=${X_FRAME_OPTIONS:-DENY}
X_CONTENT_TYPE_OPTIONS=${X_CONTENT_TYPE_OPTIONS:-nosniff}
X_XSS_PROTECTION=${X_XSS_PROTECTION:-'1; mode=block'}
REFERRER_POLICY=${REFERRER_POLICY:-strict-origin-when-cross-origin}

# SSL/TLS Configuration
SSL_PROTOCOLS=${SSL_PROTOCOLS:-TLSv1.2 TLSv1.3}
SSL_CIPHERS=${SSL_CIPHERS:-ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384}
SSL_PREFER_SERVER_CIPHERS=${SSL_PREFER_SERVER_CIPHERS:-off}
SSL_SESSION_CACHE=${SSL_SESSION_CACHE:-shared:SSL:10m}
SSL_SESSION_TIMEOUT=${SSL_SESSION_TIMEOUT:-1d}
SSL_STAPLING=${SSL_STAPLING:-on}

# DICOM Security
DICOM_AET_VALIDATION=${DICOM_AET_VALIDATION:-true}
DICOM_IP_WHITELIST=${DICOM_IP_WHITELIST:-}
DICOM_MAX_CONNECTIONS=${DICOM_MAX_CONNECTIONS:-50}

# Backup Security
BACKUP_ENCRYPTION=${BACKUP_ENCRYPTION:-true}
BACKUP_RETENTION_DAYS=${BACKUP_RETENTION_DAYS:-30}

# Monitoring
ENABLE_SECURITY_MONITORING=${ENABLE_SECURITY_MONITORING:-true}
FAILED_LOGIN_THRESHOLD=${FAILED_LOGIN_THRESHOLD:-5}
SUSPICIOUS_ACTIVITY_ALERT=${SUSPICIOUS_ACTIVITY_ALERT:-true}