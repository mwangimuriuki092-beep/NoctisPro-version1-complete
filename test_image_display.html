<!DOCTYPE html>
<html>
<head>
    <title>DICOM Image Display Test</title>
    <style>
        body {
            background: #1a1a1a;
            color: white;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        #canvas {
            border: 2px solid #00d4ff;
            background: black;
            display: block;
            margin: 20px auto;
        }
        #status {
            text-align: center;
            padding: 10px;
            background: #333;
            border-radius: 5px;
            margin: 20px auto;
            max-width: 600px;
        }
        .success { color: #00ff88; }
        .error { color: #ff4444; }
    </style>
</head>
<body>
    <h1 style="text-align: center;">DICOM Image Display Test</h1>
    <div id="status">Loading...</div>
    <canvas id="canvas"></canvas>
    
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const status = document.getElementById('status');
        
        // Test loading the image directly
        async function testImageDisplay() {
            try {
                status.innerHTML = 'Fetching image data...';
                
                // Simulate the API call
                const response = await fetch('/dicom-viewer/api/image/1/data/professional/');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                status.innerHTML = `Image data received: ${data.width}x${data.height}, Modality: ${data.modality}`;
                
                if (data.dataUrl) {
                    status.innerHTML += '<br>Loading image from base64 data...';
                    
                    const img = new Image();
                    
                    img.onload = function() {
                        // Set canvas size
                        canvas.width = data.width || img.width;
                        canvas.height = data.height || img.height;
                        
                        // Clear and draw
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.drawImage(img, 0, 0);
                        
                        status.innerHTML = `<span class="success">✅ Image displayed successfully! (${canvas.width}x${canvas.height})</span>`;
                    };
                    
                    img.onerror = function() {
                        status.innerHTML = '<span class="error">❌ Failed to load image from data URL</span>';
                    };
                    
                    img.src = data.dataUrl;
                } else {
                    status.innerHTML = '<span class="error">No image data URL in response</span>';
                }
                
            } catch (error) {
                status.innerHTML = `<span class="error">Error: ${error.message}</span>`;
                console.error('Error:', error);
            }
        }
        
        // Run test when page loads
        testImageDisplay();
    </script>
</body>
</html>